<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${product.title} + ' - GUGU Market'">상품 상세 - GUGU Market</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary: #6B4F4F;
            --secondary: #8B7070;
            --accent: #A89080;
            --light: #E8D5D5;
        }
        .bg-primary { background-color: var(--primary); }
        .bg-secondary { background-color: var(--secondary); }
        .text-primary { color: var(--primary); }
        .border-primary { border-color: var(--primary); }
        .hover\:bg-primary:hover { background-color: var(--primary); }
        .hover\:bg-secondary:hover { background-color: var(--secondary); }
        .hover\:text-primary:hover { color: var(--primary); }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Top Bar -->
    <div class="bg-primary text-white py-2">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-end items-center space-x-6 text-sm">
                <a href="/login" class="hover:underline">로그인</a>
                <a href="/signup" class="hover:underline">회원가입</a>
            </div>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <a href="/" class="flex items-center space-x-3">
                    <i class="bi bi-shop text-4xl text-primary"></i>
                    <span class="text-3xl font-bold text-primary">GUGU Market</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Breadcrumb -->
    <div class="bg-white border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center space-x-2 text-sm text-gray-500">
                <a href="/" class="hover:text-primary">홈</a>
                <i class="bi bi-chevron-right text-xs"></i>
                <a href="#" class="hover:text-primary" th:text="${product.category.name}">카테고리</a>
                <i class="bi bi-chevron-right text-xs"></i>
                <span class="text-gray-800" th:text="${product.title}">상품명</span>
            </div>
        </div>
    </div>

    <!-- Product Detail -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Left: Product Images -->
            <div class="space-y-4">
                <!-- Main Image -->
                <div class="bg-white rounded-2xl overflow-hidden shadow-lg">
                    <img 
                        id="mainImage"
                        th:src="${product.mainImage}" 
                        th:alt="${product.title}"
                        class="w-full h-96 object-cover"
                        onerror="this.src='https://via.placeholder.com/600x400/6B4F4F/FFFFFF?text=No+Image'"
                    />
                </div>
                
                <!-- Thumbnail Images -->
                <div class="grid grid-cols-4 gap-3" th:if="${product.productImages != null && !product.productImages.empty}">
                    <div th:each="image : ${product.productImages}" 
                         class="bg-white rounded-lg overflow-hidden cursor-pointer hover:ring-2 hover:ring-primary transition-all">
                        <img 
                            th:src="${image.imageUrl}" 
                            th:alt="'상품 이미지 ' + ${image.imageOrder}"
                            class="w-full h-24 object-cover"
                            onclick="changeMainImage(this.src)"
                        />
                    </div>
                </div>
            </div>

            <!-- Right: Product Info -->
            <div class="space-y-6">
                <div class="bg-white rounded-2xl shadow-lg p-8">
                    <!-- Title -->
                    <h1 class="text-3xl font-bold text-gray-800 mb-4" th:text="${product.title}">상품명</h1>
                    
                    <!-- Price -->
                    <div class="mb-6">
                        <span class="text-4xl font-bold text-primary">
                            <span th:text="${#numbers.formatInteger(product.price, 0, 'COMMA')}">0</span>원
                        </span>
                    </div>

                    <!-- Product Meta Info -->
                    <div class="space-y-3 py-6 border-y border-gray-200">
                        <div class="flex justify-between">
                            <span class="text-gray-600">카테고리</span>
                            <span class="font-medium" th:text="${product.category.name}">전자기기</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">상태</span>
                            <span class="font-medium">중고</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">판매자</span>
                            <span class="font-medium" th:text="${product.seller.nickname}">판매자명</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">거래지역</span>
                            <span class="font-medium" th:text="${product.seller.address}">서울 강남구</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">조회수</span>
                            <span class="font-medium" th:text="${product.viewCount}">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">등록일</span>
                            <span class="font-medium" th:text="${#temporals.format(product.createdDate, 'yyyy-MM-dd')}">2025-01-01</span>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex gap-3 mt-6">
                        <button class="flex-1 bg-white border-2 border-primary text-primary hover:bg-primary hover:text-white font-bold py-4 rounded-lg transition-all duration-300 flex items-center justify-center gap-2">
                            <i class="bi bi-heart text-xl"></i>
                            찜하기
                        </button>
                        <button onclick="location.href='/purchase?productId=' + [[${product.productId}]]" class="flex-1 bg-primary hover:bg-secondary text-white font-bold py-4 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center justify-center gap-2">
                            <i class="bi bi-cart text-xl"></i>
                            구매하기
                        </button>
                    </div>

                    <!-- Share & Report -->
                    <div class="flex gap-3 mt-4">
                        <button class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 rounded-lg transition-all">
                            <i class="bi bi-share mr-2"></i>공유하기
                        </button>
                        <button class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 rounded-lg transition-all">
                            <i class="bi bi-flag mr-2"></i>신고하기
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Description -->
        <div class="mt-8 bg-white rounded-2xl shadow-lg p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">상품 설명</h2>
            <div class="prose max-w-none text-gray-700 leading-relaxed whitespace-pre-line" th:text="${product.content}">
                상품 설명 내용이 여기에 표시됩니다.
            </div>
        </div>

        <!-- Comments Section -->
        <div class="mt-8 bg-white rounded-2xl shadow-lg p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">
                댓글 <span class="text-primary" th:text="${product.comments != null ? product.comments.size() : 0}">0</span>
            </h2>

            <!-- Comment Form -->
            <form th:action="@{/comment}" method="post" class="mb-8">
                <input type="hidden" name="productId" th:value="${product.productId}" />
                <textarea 
                    name="content"
                    rows="3" 
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-primary resize-none"
                    placeholder="댓글을 입력하세요..."
                    required
                ></textarea>
                <div class="flex justify-end mt-3">
                    <button 
                        type="submit"
                        class="bg-primary hover:bg-secondary text-white font-medium px-6 py-2 rounded-lg transition-all"
                    >
                        댓글 작성
                    </button>
                </div>
            </form>

            <!-- Comments List -->
            <div class="space-y-4">
                <!-- Comment Item -->
                <div th:each="comment : ${product.comments}" class="border-b border-gray-200 pb-4 last:border-b-0">
                    <div class="flex items-start justify-between mb-2">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center">
                                <i class="bi bi-person text-gray-600 text-xl"></i>
                            </div>
                            <div>
                                <p class="font-semibold text-gray-800" th:text="${comment.user.nickname}">사용자명</p>
                                <p class="text-sm text-gray-500" th:text="${#temporals.format(comment.createdDate, 'yyyy-MM-dd HH:mm')}">2025-01-01 12:00</p>
                            </div>
                        </div>
                        <button class="text-gray-400 hover:text-gray-600">
                            <i class="bi bi-three-dots-vertical"></i>
                        </button>
                    </div>
                    <p class="text-gray-700 ml-13 whitespace-pre-line" th:text="${comment.content}">댓글 내용</p>
                    
                    <!-- Reply Button -->
                    <button class="ml-13 mt-2 text-sm text-gray-500 hover:text-primary">
                        <i class="bi bi-reply mr-1"></i>답글
                    </button>
                </div>

                <!-- Empty State -->
                <div th:if="${product.comments == null || product.comments.empty}" class="text-center py-8 text-gray-500">
                    <i class="bi bi-chat-dots text-4xl mb-2"></i>
                    <p>첫 댓글을 작성해보세요!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-primary text-white mt-20 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p>&copy; 2025 GUGU Market. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Change main image when clicking thumbnail
        function changeMainImage(src) {
            document.getElementById('mainImage').src = src;
        }
    </script>
</body>
</html>